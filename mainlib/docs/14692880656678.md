##在线客服系统帮助·热备实现(未启用)

版本|日期|作者
:--:|:--:|:--
1.0|2016年6月22日|董骐瑞

---

(需要nginx版本部署)  
客服系统遇单点故障，会自动切换。  
具体情况如下：  
1. Openfire服务故障，新客户会切到备机，客服Spark显示为退出fastpath队列，注销重新登录即可。
- Webchat服务故障，新客户自动分配无故障的机器，无需操作。
首次配置如下：  
1. 配置80,9092端口号，并将热备份机器配为backup，其中80端口可以不标记备机、但是9092端口一定要标记。  
注意：ip_hash参数不能同backup一起使用。
- Store更改Webchat端口后部署。  
- 客服Spark连接主机的9092端口，Webchat重启并配置主机的9092端口（Sit为例：184配127.0.0.1或者192.168.4.36，185配192.168.4.36，端口都为9092）。  
注意：如无重新配置的页面可删除tomcat的Catalina\localhost文件夹并重启。

####热升级实现：
正常情况下客服系统升级需要等到晚上十点，现在升级无需停机，进行升级时按下面操作。
#####Openfire、Fastpath升级步骤如下：
主机正常服务时备机直接升级即可，备机升级完成后进行主机升级，如下操作：。
1、配置nginx，将9092监听端口待升级机器IP配为backup，nginx -s reload命令重启。
2、客服保证至少有一人A在服务状态，其余人依次注销重新登录Spark，A无咨询服务即可重新登录。
3、主机Openfire升级即可。
4、恢复nginx配置，nginx -s reload命令重启。
5、客服按步骤二方法重新登录。
#####Webchat升级步骤如下：
主机正常服务时备机直接升级即可，备机升级完成后进行主机升级，客服无需操作。
1、配置nginx，将80监听端口待升级机器IP配为backup，nginx -s reload命令重启。
2、当前服务中的客户服务完毕后方可进行下一步。
3、主机完成tomcat升级，使用8088端口登录页面查看是否需要配置，配置主机的9092不能错。
4、恢复nginx配置，nginx -s reload命令重启。


